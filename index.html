<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bonjour Monde</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <link rel="stylesheet" href="styles.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="site-header__bar">
      <div class="site-header__brand">MAES Studio</div>
      <nav class="site-header__nav" aria-label="Navigation principale">
        <a href="#intro">Introduction</a>
        <a href="#chart">Visualisation</a>
        <a href="#profiles">Profils</a>
      </nav>
      <a class="site-header__pill" href="#chart">Lancer la d√©mo</a>
    </div>
  </header>

  <section class="hero">
    <div class="hero__overlay"></div>
    <div class="hero__content">
      <div class="hero__layout">
        <div class="hero__main">
          <p class="hero__eyebrow">MAES Studio ¬∑ Prototype interactif</p>
          <h1 class="hero__title">Cartographier les sc√©narios, sans friction</h1>
          <p class="hero__subtitle">Une interface claire pour explorer les param√®tres, comparer les profils et passer d'une intuition √† une visualisation convaincante.</p>
          <div class="hero__actions">
            <a class="hero__cta" href="#intro">D√©couvrir la m√©thode</a>
            <a class="hero__ghost" href="#chart">Acc√©der aux visualisations</a>
          </div>
          <div class="hero__highlights" aria-label="Points forts">
            <div class="hero__highlight">
              <span class="hero__highlight-title">Lecture instantan√©e</span>
              <span class="hero__highlight-text">Axes, unit√©s et annotations clairs pour garder le contr√¥le.</span>
            </div>
            <div class="hero__highlight">
              <span class="hero__highlight-title">Pilotage guid√©</span>
              <span class="hero__highlight-text">Des sliders lisibles et des profils verrouill√©s pour it√©rer vite.</span>
            </div>
            <div class="hero__highlight">
              <span class="hero__highlight-title">R√©sultats partageables</span>
              <span class="hero__highlight-text">Un √©tat de simulation pr√™t √† √™tre pr√©sent√© ou document√©.</span>
            </div>
          </div>
        </div>
        <div class="hero__panel" aria-label="Aper√ßu des donn√©es">
          <p class="hero__panel-eyebrow">Aper√ßu dynamique</p>
          <h2 class="hero__panel-title">Tableau de bord condens√©</h2>
          <div class="hero__panel-grid">
            <div class="hero__panel-card">
              <span class="hero__panel-label">Param√®tres actifs</span>
              <span class="hero__panel-value">5 r√©glages</span>
            </div>
            <div class="hero__panel-card">
              <span class="hero__panel-label">Solutions compar√©es</span>
              <span class="hero__panel-value">26 points</span>
            </div>
            <div class="hero__panel-card">
              <span class="hero__panel-label">Profils disponibles</span>
              <span class="hero__panel-value">6 courbes</span>
            </div>
            <div class="hero__panel-card hero__panel-card--accent">
              <span class="hero__panel-label">Mise √† jour</span>
              <span class="hero__panel-value">Temps r√©el</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main id="intro" class="intro">
    <div class="intro__card">
      <p class="intro__eyebrow">Introduction</p>
      <h2>Une base solide pour les d√©monstrations MAES</h2>
      <p class="intro__lede">La plateforme met en avant les donn√©es essentielles, tout en gardant une esth√©tique douce et structur√©e. Chaque section est pens√©e pour soutenir une narration claire, de la prise en main √† l'analyse.</p>
      <div class="intro__grid" aria-label="Atouts de la d√©mo">
        <div class="intro__tile">
          <div class="intro__icon">‚ú®</div>
          <div>
            <div class="intro__tile-title">Design √©ditorial</div>
            <p class="intro__tile-text">Typographies sobres, contrastes √©quilibr√©s et cartes modulaires pour une lecture rapide.</p>
          </div>
        </div>
        <div class="intro__tile">
          <div class="intro__icon">üéõÔ∏è</div>
          <div>
            <div class="intro__tile-title">Contr√¥les sc√©naris√©s</div>
            <p class="intro__tile-text">Les param√®tres sont contextualis√©s pour rester lisibles, m√™me lors d'ajustements complexes.</p>
          </div>
        </div>
        <div class="intro__tile">
          <div class="intro__icon">üìà</div>
          <div>
            <div class="intro__tile-title">Visualisation pilot√©e</div>
            <p class="intro__tile-text">Les indicateurs cl√©s se synchronisent avec le nuage de points et les courbes d√©taill√©es.</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <section id="chart" class="chart" aria-label="Visualisation">
    <div class="chart__card">
      <div class="chart__body">
        <div class="chart__controls" aria-label="R√©glages du nuage de points">
          <div class="chart__control-group">
            <p class="chart__eyebrow chart__eyebrow--sub">Param√®tres d'entr√©e</p>
            <div class="chart__slider-grid">
              <div class="chart__control">
                <div class="chart__control-row chart__control-row--aspect">
                  <label for="p1-slider" class="chart__control-label--aspect">
                    <span class="chart__label-text">Aspect ratio</span>
                    <span class="chart__label-math">
                      <span class="math-label" data-latex="\varepsilon"></span>
                      <span class="chart__label-equals">=</span>
                      <span id="p1-label-value" class="chart__label-value">50</span>
                    </span>
                  </label>
                  <input id="p1-slider" type="range" min="0" max="100" step="1" value="50">
                </div>
              </div>
              <div class="chart__control">
                <div class="chart__control-row chart__control-row--aspect">
                  <label for="p2-slider" class="chart__control-label--aspect">
                    <span class="chart__label-text">Magnetic diffusivity</span>
                    <span class="chart__label-math">
                      <span class="math-label" data-latex="\alpha_m"></span>
                      <span class="chart__label-equals">=</span>
                      <span id="p2-label-value" class="chart__label-value">40</span>
                    </span>
                  </label>
                  <input id="p2-slider" type="range" min="0" max="100" step="1" value="40">
                </div>
              </div>
              <div class="chart__control">
                <div class="chart__control-row chart__control-row--aspect">
                  <label for="p3-slider" class="chart__control-label--aspect">
                    <span class="chart__label-text">Magnetic diffusivity anisotropy</span>
                    <span class="chart__label-math">
                      <span class="math-label" data-latex="\chi_m"></span>
                      <span class="chart__label-equals">=</span>
                      <span id="p3-label-value" class="chart__label-value">30</span>
                    </span>
                  </label>
                  <input id="p3-slider" type="range" min="0" max="100" step="1" value="30">
                </div>
              </div>
              <div class="chart__control">
                <div class="chart__control-row chart__control-row--aspect">
                  <label for="p4-slider" class="chart__control-label--aspect">
                    <span class="chart__label-text">Magnetic Prandtl number</span>
                    <span class="chart__label-math">
                      <span class="math-label" data-latex="\mathcal{P}_m"></span>
                      <span class="chart__label-equals">=</span>
                      <span id="p4-label-value" class="chart__label-value">60</span>
                    </span>
                  </label>
                  <input id="p4-slider" type="range" min="0" max="100" step="1" value="60">
                </div>
              </div>
              <div class="chart__control">
                <div class="chart__control-row chart__control-row--aspect">
                  <label for="p5-slider" class="chart__control-label--aspect">
                    <span class="chart__label-text">Turbulent magnetic pressure</span>
                    <span class="chart__label-math">
                      <span class="math-label" data-latex="\alpha_p"></span>
                      <span class="chart__label-equals">=</span>
                      <span id="p5-label-value" class="chart__label-value">20</span>
                    </span>
                  </label>
                  <input id="p5-slider" type="range" min="0" max="100" step="1" value="20">
                </div>
              </div>
              <div class="chart__control">
                <div class="chart__control-row chart__control-row--dropdowns">
                  <div class="chart__dropdown">
                    <label for="turbulence-profile-select" class="chart__dropdown-label">Turbulence profile</label>
                    <select id="turbulence-profile-select" class="chart__select chart__select--profile" aria-label="Choisir un profil de turbulence">
                      <option value="exponential-decrease">Exponential decrease</option>
                    </select>
                  </div>
                  <div class="chart__dropdown">
                    <label for="heat-profile-select" class="chart__dropdown-label">Heat profile</label>
                    <select id="heat-profile-select" class="chart__select chart__select--profile" aria-label="Choisir un profil de chaleur">
                      <option value="isothermal">Isothermal</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="chart__control">
                <div class="chart__control-row chart__control-row--toggles">
                  <div class="chart__toggle-group">
                    <span class="chart__dropdown-label">Solution type</span>
                    <div class="chart__button-row" role="group" aria-label="Choisir SM, A ou FM">
                      <button type="button" class="chart__toggle-button chart__toggle-button--active" data-scenario="SM">SM</button>
                      <button type="button" class="chart__toggle-button" data-scenario="A">A</button>
                      <button type="button" class="chart__toggle-button" data-scenario="FM">FM</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="chart__figure" role="img" aria-label="Graphique en nuage de points">
          <div class="chart__axis-overlay" aria-label="R√©glages rapides des axes">
            <div class="chart__axis-overlay-grid">
              <div class="chart__axis-control">
                <div class="chart__axis-row">
                  <label class="chart__select-label" for="x-axis-select">X</label>
                  <select id="x-axis-select" class="chart__select chart__select--axis" aria-label="Choisir la grandeur pour l'axe X">
                    <option value="g1">g1</option>
                    <option value="g2">g2</option>
                    <option value="g3">g3</option>
                    <option value="g4">g4</option>
                    <option value="g5">g5</option>
                    <option value="g6">g6</option>
                    <option value="g7">g7</option>
                    <option value="g8">g8</option>
                    <option value="g9">g9</option>
                    <option value="g10">g10</option>
                    <option value="g11">g11</option>
                    <option value="g12">g12</option>
                    <option value="g13">g13</option>
                    <option value="g14">g14</option>
                    <option value="g15">g15</option>
                    <option value="g16">g16</option>
                    <option value="g17">g17</option>
                    <option value="g18">g18</option>
                    <option value="g19">g19</option>
                    <option value="g20">g20</option>
                  </select>
                </div>
                <select id="x-scale-select" class="chart__select chart__select--scale" data-scale-select="x" aria-label="√âchelle de l'axe X">
                  <option value="linear">Lin√©aire</option>
                  <option value="log">Logarithmique</option>
                </select>
              </div>
              <div class="chart__axis-control">
                <div class="chart__axis-row">
                  <label class="chart__select-label" for="y-axis-select">Y</label>
                  <select id="y-axis-select" class="chart__select chart__select--axis" aria-label="Choisir la grandeur pour l'axe Y">
                    <option value="g2">g2</option>
                    <option value="g1">g1</option>
                    <option value="g3">g3</option>
                    <option value="g4">g4</option>
                    <option value="g5">g5</option>
                    <option value="g6">g6</option>
                    <option value="g7">g7</option>
                    <option value="g8">g8</option>
                    <option value="g9">g9</option>
                    <option value="g10">g10</option>
                    <option value="g11">g11</option>
                    <option value="g12">g12</option>
                    <option value="g13">g13</option>
                    <option value="g14">g14</option>
                    <option value="g15">g15</option>
                    <option value="g16">g16</option>
                    <option value="g17">g17</option>
                    <option value="g18">g18</option>
                    <option value="g19">g19</option>
                    <option value="g20">g20</option>
                  </select>
                </div>
                <select id="y-scale-select" class="chart__select chart__select--scale" data-scale-select="y" aria-label="√âchelle de l'axe Y">
                  <option value="linear">Lin√©aire</option>
                  <option value="log">Logarithmique</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="chart__hovered" aria-live="polite">
          <div class="chart__hovered-header">
            <div>
              <p class="chart__eyebrow chart__eyebrow--sub">Solution MHD</p>
            </div>
          </div>
          <div id="hovered-values" class="chart__hovered-body">
            <ul class="chart__hovered-list">
              <li class="chart__hovered-title">Input parameters</li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Aspect ratio</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Magnetic diffusivity</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\alpha_m"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Magnetic diffusivity anisotropy</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\chi_m"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Magnetic Prandtl number</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\mathcal{P}_m"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Turbulent magnetic pressure</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\alpha_p"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-title">Disk properties</li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Ejection index</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\xi"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Magnetization</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\mu"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Toroidal electric current</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="p"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Radial electric current</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="q"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Rotation</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\delta"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-title">Jet properties</li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 11</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 12</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 13</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 14</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 15</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-title">Miscellaneous</li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 16</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 17</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 18</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 19</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
              <li class="chart__hovered-item chart__control-label--aspect">
                <span class="chart__label-text">Grandeur 20</span>
                <span class="chart__label-math">
                  <span class="math-label" data-latex="\varepsilon"></span>
                  <span class="chart__label-equals">=</span>
                  <span class="chart__label-value">‚Äï</span>
                </span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="chart__profiles" aria-live="polite">
        <div class="chart__profiles-header">
          <div>
            <p class="chart__eyebrow chart__eyebrow--sub">Profils 1D</p>
          </div>
        </div>
        <div id="profile-content" class="chart__profiles-grid">
          <p class="chart__profiles-placeholder">Cliquez sur un point pour afficher les courbes correspondantes.</p>
        </div>
      </div>

    </div>
  </section>

  <section id="profiles" class="footer">
    <p>Cr√©√© avec ‚ù§Ô∏è pour d√©marrer rapidement.</p>
  </section>

  <script>
    const chartContainer = document.querySelector('.chart__figure');
    const chartControls = document.querySelector('.chart__controls');
    const chartBody = document.querySelector('.chart__body');
    const tooltip = document.createElement('div');
    tooltip.className = 'chart__tooltip';
    chartContainer.appendChild(tooltip);

    const profileContent = document.getElementById('profile-content');
    const hoveredValues = document.getElementById('hovered-values');
    const scenarioButtons = Array.from(document.querySelectorAll('[data-scenario]'));
    const scaleSelects = Array.from(document.querySelectorAll('[data-scale-select]'));
    const resizeObserver = 'ResizeObserver' in window
      ? new ResizeObserver(() => updateChart())
      : null;

    const sliders = [
      {
        id: 'p1',
        element: document.getElementById('p1-slider'),
        labelValue: document.getElementById('p1-label-value')
      },
      {
        id: 'p2',
        element: document.getElementById('p2-slider'),
        labelValue: document.getElementById('p2-label-value')
      },
      {
        id: 'p3',
        element: document.getElementById('p3-slider'),
        labelValue: document.getElementById('p3-label-value')
      },
      {
        id: 'p4',
        element: document.getElementById('p4-slider'),
        labelValue: document.getElementById('p4-label-value')
      },
      {
        id: 'p5',
        element: document.getElementById('p5-slider'),
        labelValue: document.getElementById('p5-label-value')
      },
    ];
    const xAxisSelect = document.getElementById('x-axis-select');
    const yAxisSelect = document.getElementById('y-axis-select');
    let xScaleType = 'linear';
    let yScaleType = 'linear';
    let selectedScenario = 'SM';
    let currentSolutions = [];
    let selectedSolutionIndex = null;
    let pinnedSolutionIndex = null;

    let width = 0;
    let height = 0;
    const margin = { top: 24, right: 24, bottom: 48, left: 48 };

    const svgNS = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
    svg.setAttribute('role', 'presentation');

    let innerWidth = 0;
    let innerHeight = 0;

    const axes = document.createElementNS(svgNS, 'g');
    axes.setAttribute('stroke', 'var(--color-axis)');
    axes.setAttribute('stroke-width', '1.5');
    axes.setAttribute('shape-rendering', 'crispEdges');

    const xAxis = document.createElementNS(svgNS, 'line');
    xAxis.setAttribute('x1', margin.left);
    xAxis.setAttribute('x2', margin.left + innerWidth);
    xAxis.setAttribute('y1', margin.top + innerHeight);
    xAxis.setAttribute('y2', margin.top + innerHeight);
    axes.appendChild(xAxis);

    const yAxis = document.createElementNS(svgNS, 'line');
    yAxis.setAttribute('x1', margin.left);
    yAxis.setAttribute('x2', margin.left);
    axes.appendChild(yAxis);

    const xTicksGroup = document.createElementNS(svgNS, 'g');
    const yTicksGroup = document.createElementNS(svgNS, 'g');
    const xAxisLabel = document.createElementNS(svgNS, 'text');
    const yAxisLabel = document.createElementNS(svgNS, 'text');

    xAxisLabel.setAttribute('fill', 'var(--color-axis-label)');
    xAxisLabel.setAttribute('stroke', 'none');
    xAxisLabel.setAttribute('font-size', '12');
    xAxisLabel.setAttribute('text-anchor', 'middle');
    xAxisLabel.setAttribute('x', margin.left + innerWidth / 2);
    xAxisLabel.setAttribute('y', margin.top + innerHeight + 36);

    yAxisLabel.setAttribute('fill', 'var(--color-axis-label)');
    yAxisLabel.setAttribute('stroke', 'none');
    yAxisLabel.setAttribute('font-size', '12');
    yAxisLabel.setAttribute('text-anchor', 'middle');
    yAxisLabel.setAttribute('transform', `translate(${margin.left - 36} ${margin.top + innerHeight / 2}) rotate(-90)`);

    axes.appendChild(xTicksGroup);
    axes.appendChild(yTicksGroup);
    axes.appendChild(xAxisLabel);
    axes.appendChild(yAxisLabel);

    svg.appendChild(axes);

    const pointsGroup = document.createElementNS(svgNS, 'g');
    svg.appendChild(pointsGroup);

    chartContainer.appendChild(svg);

    function resizeChart() {
      if (chartControls && chartBody) {
        chartBody.style.setProperty('--chart-controls-height', `${chartControls.offsetHeight}px`);
      }

      width = chartContainer.clientWidth || 720;
      height = chartContainer.clientHeight || 320;
      innerWidth = width - margin.left - margin.right;
      innerHeight = height - margin.top - margin.bottom;

      svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

      xAxis.setAttribute('x2', margin.left + innerWidth);
      xAxis.setAttribute('y1', margin.top + innerHeight);
      xAxis.setAttribute('y2', margin.top + innerHeight);
      yAxis.setAttribute('y1', margin.top);
      yAxis.setAttribute('y2', margin.top + innerHeight);

      xAxisLabel.setAttribute('x', margin.left + innerWidth / 2);
      xAxisLabel.setAttribute('y', margin.top + innerHeight + 36);
      yAxisLabel.setAttribute('transform', `translate(${margin.left - 36} ${margin.top + innerHeight / 2}) rotate(-90)`);
    }

    function createScale(domain, scaleType, axis) {
      const normalize = scaleType === 'log'
        ? (value) => Math.log10(Math.max(value, domain.min))
        : (value) => value;

      const start = normalize(domain.min);
      const end = normalize(domain.max);
      const span = end - start || 1;

      return (value) => {
        const position = (normalize(value) - start) / span;
        return axis === 'x'
          ? margin.left + position * innerWidth
          : margin.top + innerHeight - position * innerHeight;
      };
    }

    function clamp(value, min, max) {
      return Math.min(Math.max(value, min), max);
    }

    function buildProfiles(base) {
      const sampleCount = 24;
      const xValues = Array.from({ length: sampleCount }, (_, i) => Number(((i / (sampleCount - 1)) * 10).toFixed(2)));
      const scenarioShift = base.scenario === 'A' ? 6 : base.scenario === 'FM' ? -4 : 0;

      const pressure = xValues.map((x) => {
        return clamp(85 + scenarioShift + 0.5 * base.p1 - 0.3 * base.p3 + Math.sin(x / 1.8 + base.p2 / 60) * 9 + (Math.random() - 0.5) * 2, 40, 180);
      });

      const density = xValues.map((x) => {
        return clamp(0.9 + 0.012 * base.p2 + scenarioShift / 60 + Math.cos(x / 2.4 + base.p5 / 35) * 0.25 + (Math.random() - 0.5) * 0.04, 0.6, 2.4);
      });

      const temperature = xValues.map((x) => {
        return clamp(260 + 0.75 * base.p4 + scenarioShift * 1.5 + Math.sin((x + base.p3 / 6) / 2.8) * 14 + (Math.random() - 0.5) * 4, 230, 420);
      });

      const radialVelocity = xValues.map((x) => {
        return clamp(-12 + 0.25 * base.p1 - 0.18 * base.p2 + scenarioShift * 0.35 + Math.sin((x + base.p4 / 8) / 2.3) * 6 + (Math.random() - 0.5) * 1.5, -40, 40);
      });

      const toroidalVelocity = xValues.map((x) => {
        return clamp(80 + 0.9 * base.p4 + 0.3 * base.p5 + scenarioShift * 1.6 + Math.cos((x + base.p3 / 5) / 2.1) * 18 + (Math.random() - 0.5) * 3, 40, 200);
      });

      const verticalVelocity = xValues.map((x) => {
        return clamp(10 + 0.4 * base.p2 + 0.2 * base.p3 + scenarioShift * 0.9 + Math.sin((x + base.p1 / 10) / 2.6) * 8 + (Math.random() - 0.5) * 2, 0, 80);
      });

      return { x: xValues, pressure, density, temperature, radialVelocity, toroidalVelocity, verticalVelocity };
    }

    function buildSolutions(baseParams, scenario) {
      const solutions = [];
      const sampleCount = 26;
      const numericParams = Object.fromEntries(
        Object.entries(baseParams).filter(([key]) => key.startsWith('p'))
      );
      const scenarioOffset = scenario === 'A' ? 12 : scenario === 'FM' ? -8 : 0;

      for (let i = 0; i < sampleCount; i++) {
        const jittered = Object.fromEntries(
          Object.entries(numericParams).map(([key, base]) => [
            key,
            clamp(base + (Math.random() - 0.5) * 14, 0, 100)
          ])
        );

        const { p1, p2, p3, p4, p5 } = jittered;
        const noise = (span) => (Math.random() - 0.5) * span;

        const g1 = 0.6 * p1 + 0.4 * p2 + 5 * Math.sin(p3 / 18) + scenarioOffset + noise(8);
        const g2 = 1.05 * p2 + 0.25 * p3 + scenarioOffset * 0.6 + noise(10);
        const g3 = 0.5 * p3 + 0.8 * p4 + 12 * Math.cos(p1 / 30) + scenarioOffset * 0.8 + noise(9);
        const g4 = 0.9 * p4 + 0.2 * p1 + scenarioOffset * 0.4 + noise(7);
        const g5 = 0.7 * p5 + 0.35 * p2 + scenarioOffset * 0.2 + noise(7);
        const g6 = 0.8 * p1 + 0.5 * p3 - 0.3 * p5 + 40 + scenarioOffset + noise(12);
        const g7 = 0.6 * p2 + 0.6 * p5 + scenarioOffset * 0.5 + noise(10);
        const g8 = 0.4 * p3 + 0.9 * p4 + scenarioOffset * 0.4 + noise(8);
        const g9 = 0.5 * p1 + 0.5 * p4 + scenarioOffset * 0.3 + noise(6);
        const g10 = 0.7 * p2 + 0.2 * p3 + 0.4 * p5 + scenarioOffset * 0.5 + noise(10);
        const g11 = 0.35 * p1 + 0.65 * p2 + 0.15 * p4 + scenarioOffset * 0.4 + noise(9);
        const g12 = 0.2 * p2 + 0.85 * p3 + 0.1 * p5 + 20 + scenarioOffset * 0.3 + noise(11);
        const g13 = 0.55 * p4 + 0.45 * p5 + 5 * Math.cos(p2 / 22) + scenarioOffset * 0.5 + noise(8);
        const g14 = 0.4 * p1 + 0.25 * p3 + 0.35 * p5 + 15 + scenarioOffset * 0.2 + noise(10);
        const g15 = 0.6 * p2 + 0.25 * p4 + 0.2 * p5 + 8 * Math.sin(p1 / 28) + scenarioOffset * 0.6 + noise(9);
        const g16 = 0.45 * p1 + 0.55 * p4 + 0.2 * p5 + 18 + scenarioOffset * 0.4 + noise(10);
        const g17 = 0.3 * p2 + 0.6 * p3 + 0.4 * p5 + 12 * Math.cos(p4 / 30) + scenarioOffset * 0.5 + noise(9);
        const g18 = 0.5 * p1 + 0.3 * p3 + 0.7 * p4 + scenarioOffset * 0.3 + noise(8);
        const g19 = 0.65 * p2 + 0.2 * p4 + 0.25 * p5 + 10 * Math.sin(p3 / 26) + scenarioOffset * 0.4 + noise(11);
        const g20 = 0.4 * p1 + 0.4 * p2 + 0.4 * p3 + 10 + scenarioOffset * 0.2 + noise(10);

        const solution = { ...jittered, scenario };

        solutions.push({
          ...solution,
          profiles: buildProfiles(solution),
          g1: clamp(g1, 0, 200),
          g2: clamp(g2, 0, 200),
          g3: clamp(g3, 0, 200),
          g4: clamp(g4, 0, 200),
          g5: clamp(g5, 0, 200),
          g6: clamp(g6, 0, 200),
          g7: clamp(g7, 0, 200),
          g8: clamp(g8, 0, 200),
          g9: clamp(g9, 0, 200),
          g10: clamp(g10, 0, 200),
          g11: clamp(g11, 0, 200),
          g12: clamp(g12, 0, 200),
          g13: clamp(g13, 0, 200),
          g14: clamp(g14, 0, 200),
          g15: clamp(g15, 0, 200),
          g16: clamp(g16, 0, 200),
          g17: clamp(g17, 0, 200),
          g18: clamp(g18, 0, 200),
          g19: clamp(g19, 0, 200),
          g20: clamp(g20, 0, 200)
        });
      }

      return solutions;
    }

    function getDomain(values, scaleType = 'linear') {
      const min = Math.min(...values);
      const max = Math.max(...values);

      if (scaleType === 'log') {
        const positives = values.filter((value) => value > 0);
        const smallestPositive = positives.length ? Math.min(...positives) : Math.max(min, 0.1);
        const safeMin = Math.max(smallestPositive, 0.1);
        const paddedMin = safeMin / 1.4;
        const paddedMax = Math.max(max, safeMin * 10) * 1.05;
        return { min: paddedMin, max: paddedMax };
      }

      const span = max - min;
      const padding = Math.max(span * 0.08, 4);
      return { min: min - padding, max: max + padding };
    }

    function buildTicks(domain, scaleType = 'linear', tickCount = 5) {
      if (scaleType === 'log') {
        const ticks = [];
        const startExp = Math.floor(Math.log10(domain.min));
        const endExp = Math.ceil(Math.log10(domain.max));

        for (let exp = startExp; exp <= endExp; exp++) {
          const value = 10 ** exp;
          if (value >= domain.min && value <= domain.max) {
            ticks.push(value);
          }
        }

        if (!ticks.includes(domain.max)) {
          ticks.push(domain.max);
        }

        return ticks;
      }

      return Array.from({ length: tickCount + 1 }, (_, i) => domain.min + (domain.max - domain.min) * (i / tickCount));
    }

    function formatTick(value) {
      return Math.abs(value) >= 100 ? value.toFixed(0) : value.toFixed(1);
    }

    function renderAxes(xDomain, yDomain, xLabel, yLabel, xScale, yScale, xType, yType) {
      xTicksGroup.innerHTML = '';
      yTicksGroup.innerHTML = '';

      const xTicks = buildTicks(xDomain, xType);
      const yTicks = buildTicks(yDomain, yType);

      xTicks.forEach((xValue) => {
        const xPos = xScale(xValue);
        const xTick = document.createElementNS(svgNS, 'line');
        xTick.setAttribute('x1', xPos);
        xTick.setAttribute('x2', xPos);
        xTick.setAttribute('y1', margin.top + innerHeight);
        xTick.setAttribute('y2', margin.top + innerHeight + 6);
        xTick.setAttribute('stroke', 'var(--color-axis)');
        xTicksGroup.appendChild(xTick);

        const xTickLabel = document.createElementNS(svgNS, 'text');
        xTickLabel.textContent = formatTick(xValue);
        xTickLabel.setAttribute('x', xPos);
        xTickLabel.setAttribute('y', margin.top + innerHeight + 22);
        xTickLabel.setAttribute('fill', 'var(--color-axis-label)');
        xTickLabel.setAttribute('stroke', 'none');
        xTickLabel.setAttribute('font-size', '12');
        xTickLabel.setAttribute('text-anchor', 'middle');
        xTicksGroup.appendChild(xTickLabel);
      });

      yTicks.forEach((yValue) => {
        const yPos = yScale(yValue);
        const yTick = document.createElementNS(svgNS, 'line');
        yTick.setAttribute('x1', margin.left - 6);
        yTick.setAttribute('x2', margin.left);
        yTick.setAttribute('y1', yPos);
        yTick.setAttribute('y2', yPos);
        yTick.setAttribute('stroke', 'var(--color-axis)');
        yTicksGroup.appendChild(yTick);

        const yTickLabel = document.createElementNS(svgNS, 'text');
        yTickLabel.textContent = formatTick(yValue);
        yTickLabel.setAttribute('x', margin.left - 12);
        yTickLabel.setAttribute('y', yPos + 4);
        yTickLabel.setAttribute('fill', 'var(--color-axis-label)');
        yTickLabel.setAttribute('stroke', 'none');
        yTickLabel.setAttribute('font-size', '12');
        yTickLabel.setAttribute('text-anchor', 'end');
        yTicksGroup.appendChild(yTickLabel);
      });

      xAxisLabel.textContent = xLabel;
      yAxisLabel.textContent = yLabel;
    }

    function positionTooltip(event) {
      const bounds = chartContainer.getBoundingClientRect();
      const offsetX = event.clientX - bounds.left;
      const offsetY = event.clientY - bounds.top;
      tooltip.style.left = `${offsetX + 14}px`;
      tooltip.style.top = `${offsetY + 14}px`;
    }

    function renderMathLabels(scope = document) {
      if (!window.katex) return;

      scope.querySelectorAll('.math-label').forEach((element) => {
        const latex = element.dataset.latex;
        if (!latex) return;

        window.katex.render(latex, element, { throwOnError: false });
      });
    }

    function buildHoveredList(entries, valueFormatter) {
      const rows = entries
        .reduce((acc, key, index) => {
          if (index % 5 === 0) {
            const start = index + 1;
            const end = Math.min(index + 5, entries.length);
            const titles = {
              1: "Input parameters",
              6: "Disk properties",
              11: "Jet properties",
              16: "Miscellaneous",
            };
            acc.push(
              `<li class="chart__hovered-title">${titles[start]}</li>`
            );
          }
          const value = valueFormatter(key);
          acc.push(`
          <li class="chart__hovered-item chart__control-label--aspect">
            <span class="chart__label-text">Grandeur ${key.slice(1)}</span>
            <span class="chart__label-math">
              <span class="math-label" data-latex="\\varepsilon"></span>
              <span class="chart__label-equals">=</span>
              <span class="chart__label-value">${value}</span>
            </span>
          </li>
        `);
          return acc;
        }, [])
        .join('');

      return `
        <ul class="chart__hovered-list">
          ${rows}
        </ul>
      `;
    }

    function renderHoveredValues(solution) {
      if (!hoveredValues || !solution) return;

      const entries = Object.entries(solution)
        .filter(([key]) => key.startsWith('g'))
        .sort(([a], [b]) => Number(a.slice(1)) - Number(b.slice(1)))
        .map(([key]) => key);

      hoveredValues.innerHTML = buildHoveredList(entries, (key) => solution[key].toFixed(1));
      renderMathLabels(hoveredValues);
    }

    function renderEmptyHoveredValues() {
      if (!hoveredValues) return;

      const entries = Array.from({ length: 20 }, (_, index) => `g${index + 1}`);
      hoveredValues.innerHTML = buildHoveredList(entries, () => '‚Äï');
      renderMathLabels(hoveredValues);
    }

    function resetHoveredValues() {
      renderEmptyHoveredValues();
    }

    function restorePinnedValues() {
      if (pinnedSolutionIndex === null) {
        resetHoveredValues();
        return;
      }

      const pinned = currentSolutions[pinnedSolutionIndex];
      if (pinned) {
        renderHoveredValues(pinned);
      } else {
        resetHoveredValues();
      }
    }

    function renderPoints(points, xKey, yKey, scaleX, scaleY) {
      pointsGroup.innerHTML = '';
      points.forEach((point, index) => {
        const circle = document.createElementNS(svgNS, 'circle');
        circle.classList.add('chart__point');
        circle.setAttribute('cx', scaleX(point[xKey]));
        circle.setAttribute('cy', scaleY(point[yKey]));
        circle.setAttribute('r', 7);
        circle.dataset.solutionIndex = index;
        circle.setAttribute('tabindex', '0');

        if (index === selectedSolutionIndex) {
          circle.classList.add('chart__point--selected');
        }

        circle.addEventListener('pointerenter', (event) => {
          const hovered = currentSolutions[Number(circle.dataset.solutionIndex)];
          const xValue = hovered[xKey];
          const yValue = hovered[yKey];
          const rows = `
            <li>
              <span class="chart__tooltip-key">${xKey.toUpperCase()}</span>
              <span class="chart__tooltip-value">${xValue.toFixed(1)}</span>
            </li>
            <li>
              <span class="chart__tooltip-key">${yKey.toUpperCase()}</span>
              <span class="chart__tooltip-value">${yValue.toFixed(1)}</span>
            </li>
          `;

          tooltip.innerHTML = `<ul class="chart__tooltip-list">${rows}</ul>`;
          tooltip.classList.add('chart__tooltip--visible');
          positionTooltip(event);
          renderHoveredValues(hovered);
        });

        circle.addEventListener('pointermove', positionTooltip);

        circle.addEventListener('pointerleave', () => {
          tooltip.classList.remove('chart__tooltip--visible');
          restorePinnedValues();
        });

        circle.addEventListener('blur', () => {
          tooltip.classList.remove('chart__tooltip--visible');
          restorePinnedValues();
        });

        circle.addEventListener('click', () => {
          selectSolution(index);
        });

        circle.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            selectSolution(index);
          }
        });

        pointsGroup.appendChild(circle);
      });
    }

    function buildProfileChart(xValues, yValues, width = 320, height = 140) {
      const padding = { top: 28, right: 6, bottom: 38, left: 24 };
      const xMin = Math.min(...xValues);
      const xMax = Math.max(...xValues);
      const yMin = Math.min(...yValues);
      const yMax = Math.max(...yValues);
      const xRange = xMax - xMin || 1;
      const yRange = yMax - yMin || 1;
      const plotWidth = width - padding.left - padding.right;
      const plotHeight = height - padding.top - padding.bottom;

      const xScale = (x) => padding.left + ((x - xMin) / xRange) * plotWidth;
      const yScale = (y) => padding.top + plotHeight - ((y - yMin) / yRange) * plotHeight;

      const points = xValues
        .map((x, idx) => `${xScale(x)},${yScale(yValues[idx])}`)
        .join(' ');

      const yMid = (yMin + yMax) / 2;
      const yTicks = [yMin, yMid, yMax];
      const xTicks = [xMin, xMax];

      return {
        width,
        height,
        padding,
        points,
        xTicks,
        yTicks,
        format: (value) => formatTick(value),
      };
    }

    function renderProfiles(solution) {
      const { profiles } = solution;
      const series = [
        { label: 'Pression <span class="math-label" data-latex="P(x)"></span>', key: 'pressure', color: '#000000' },
        { label: 'Densit√© <span class="math-label" data-latex="\\rho(x)"></span>', key: 'density', color: '#000000' },
        { label: 'Temp√©rature <span class="math-label" data-latex="T(x)"></span>', key: 'temperature', color: '#000000' },
        { label: 'Vitesse radiale <span class="math-label" data-latex="u_r(x)"></span>', key: 'radialVelocity', color: '#000000' },
        { label: 'Vitesse toro√Ødale <span class="math-label" data-latex="u_\\phi(x)"></span>', key: 'toroidalVelocity', color: '#000000' },
        { label: 'Vitesse verticale <span class="math-label" data-latex="u_z(x)"></span>', key: 'verticalVelocity', color: '#000000' },
      ];

      profileContent.innerHTML = '';

      series.forEach((serie) => {
        const values = profiles[serie.key];
        const chart = buildProfileChart(profiles.x, values);

        const card = document.createElement('div');
        card.className = 'chart__profile-card';
        card.innerHTML = `
          <div class="chart__profile-header">
            <div>
              <div class="chart__profile-title">${serie.label}</div>
            </div>
          </div>
          <svg class="chart__sparkline" viewBox="0 0 ${chart.width} ${chart.height}" role="img" aria-label="${serie.label}">
            <g class="chart__sparkline-axes" aria-hidden="true">
              <line x1="${chart.padding.left}" y1="${chart.padding.top}" x2="${chart.padding.left}" y2="${chart.height - chart.padding.bottom}"></line>
              <line x1="${chart.padding.left}" y1="${chart.height - chart.padding.bottom}" x2="${chart.width - chart.padding.right}" y2="${chart.height - chart.padding.bottom}"></line>
              ${chart.yTicks.map((tick) => `
                <line x1="${chart.padding.left - 4}" y1="${chart.padding.top + ((chart.yTicks[2] - tick) / (chart.yTicks[2] - chart.yTicks[0] || 1)) * (chart.height - chart.padding.top - chart.padding.bottom)}"
                      x2="${chart.padding.left}" y2="${chart.padding.top + ((chart.yTicks[2] - tick) / (chart.yTicks[2] - chart.yTicks[0] || 1)) * (chart.height - chart.padding.top - chart.padding.bottom)}"></line>
              `).join('')}
              ${chart.xTicks.map((tick) => `
                <line x1="${chart.padding.left + ((tick - chart.xTicks[0]) / (chart.xTicks[1] - chart.xTicks[0] || 1)) * (chart.width - chart.padding.left - chart.padding.right)}"
                      y1="${chart.height - chart.padding.bottom}" x2="${chart.padding.left + ((tick - chart.xTicks[0]) / (chart.xTicks[1] - chart.xTicks[0] || 1)) * (chart.width - chart.padding.left - chart.padding.right)}"
                      y2="${chart.height - chart.padding.bottom + 4}"></line>
              `).join('')}
            </g>
            <g class="chart__sparkline-labels" aria-hidden="true">
              ${chart.yTicks.map((tick) => `
                <text x="${chart.padding.left - 8}" y="${chart.padding.top + ((chart.yTicks[2] - tick) / (chart.yTicks[2] - chart.yTicks[0] || 1)) * (chart.height - chart.padding.top - chart.padding.bottom) + 4}" text-anchor="end">
                  ${chart.format(tick)}
                </text>
              `).join('')}
              ${chart.xTicks.map((tick) => `
                <text x="${chart.padding.left + ((tick - chart.xTicks[0]) / (chart.xTicks[1] - chart.xTicks[0] || 1)) * (chart.width - chart.padding.left - chart.padding.right)}"
                      y="${chart.height - chart.padding.bottom + 18}" text-anchor="middle">
                  ${chart.format(tick)}
                </text>
              `).join('')}
            </g>
            <polyline class="chart__sparkline-line" fill="none" stroke="${serie.color}" stroke-width="2" points="${chart.points}" />
          </svg>
        `;

        profileContent.appendChild(card);
      });

      renderMathLabels(profileContent);
    }

    function renderFlatProfiles() {
      const fallbackX = Array.from({ length: 24 }, (_, index) => index);
      const baseProfiles = currentSolutions[0]?.profiles;
      const xValues = baseProfiles?.x ?? fallbackX;
      const flatValues = xValues.map(() => 0);

      renderProfiles({
        profiles: {
          x: xValues,
          pressure: flatValues,
          density: flatValues,
          temperature: flatValues,
          radialVelocity: flatValues,
          toroidalVelocity: flatValues,
          verticalVelocity: flatValues,
        },
      });
    }

    function selectSolution(index) {
      selectedSolutionIndex = index;
      pinnedSolutionIndex = index;
      renderProfiles(currentSolutions[index]);
      renderHoveredValues(currentSolutions[index]);

      Array.from(pointsGroup.children).forEach((circle, idx) => {
        circle.classList.toggle('chart__point--selected', idx === index);
      });
    }

    function resetProfiles() {
      selectedSolutionIndex = null;
      pinnedSolutionIndex = null;
      renderFlatProfiles();
    }

    function updateScaleSelect(axis, scaleType) {
      const select = scaleSelects.find((option) => option.dataset.scaleSelect === axis);
      if (!select) return;

      select.value = scaleType;
    }

    function updateChart() {
      resizeChart();
      const baseParams = sliders.reduce((acc, slider) => {
        const value = Number(slider.element.value);
        if (slider.labelValue) {
          slider.labelValue.textContent = value.toFixed(0);
        }
        acc[slider.id] = value;
        return acc;
      }, {});

      const xKey = xAxisSelect.value;
      const yKey = yAxisSelect.value;
      const solutions = buildSolutions(baseParams, selectedScenario);
      currentSolutions = solutions;
      resetProfiles();
      restorePinnedValues();

      const xDomain = getDomain(solutions.map(solution => solution[xKey]), xScaleType);
      const yDomain = getDomain(solutions.map(solution => solution[yKey]), yScaleType);

      const xScale = createScale(xDomain, xScaleType, 'x');
      const yScale = createScale(yDomain, yScaleType, 'y');

      renderAxes(xDomain, yDomain, xKey.toUpperCase(), yKey.toUpperCase(), xScale, yScale, xScaleType, yScaleType);
      renderPoints(solutions, xKey, yKey, xScale, yScale);
    }

    sliders.forEach(({ element }) => element.addEventListener('input', updateChart));
    xAxisSelect.addEventListener('change', updateChart);
    yAxisSelect.addEventListener('change', updateChart);

    scaleSelects.forEach((select) => {
      select.addEventListener('change', () => {
        const axis = select.dataset.scaleSelect;
        const nextScale = select.value;

        if (axis === 'x') {
          xScaleType = nextScale;
        }

        if (axis === 'y') {
          yScaleType = nextScale;
        }

        updateChart();
      });
    });

    updateScaleSelect('x', xScaleType);
    updateScaleSelect('y', yScaleType);

    scenarioButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const scenario = button.dataset.scenario;
        if (scenario === selectedScenario) return;

        selectedScenario = scenario;
        scenarioButtons.forEach((btn) => {
          btn.classList.toggle('chart__toggle-button--active', btn === button);
        });
        updateChart();
      });
    });

    window.addEventListener('resize', updateChart);

    updateChart();

    if (resizeObserver && chartControls) {
      resizeObserver.observe(chartControls);
    }

    window.addEventListener('load', () => {
      renderMathLabels();

      updateChart();
    });
  </script>
</body>
</html>
